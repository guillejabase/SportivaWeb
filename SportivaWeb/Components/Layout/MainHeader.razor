@implements IDisposable
@inject ICuentaService cuentaService
@inject NavigationManager navigationManager
@using SportivaWeb.Services
@rendermode InteractiveServer

<FluentDesignTheme @bind-Mode="modo"
                   CustomColor="#00FFE0" />

<FluentHeader>
    <FluentStack Orientation="Orientation.Horizontal"
                 VerticalAlignment="VerticalAlignment.Center"
                 Style="font-size: 24px">
        Sportiva

        <FluentSpacer />

        @if (cuentaService.Usuario == null)
        {
            <FluentIcon Value="@(new Icons.Regular.Size24.Person())"
                        Color="Color.Lightweight"
                        Title="Iniciar sesión"
                        @onclick="@(() => navigationManager.NavigateTo("/cuenta/iniciar-sesion"))" />
        }
        else
        {
            <FluentIcon Value="@(new Icons.Regular.Size24.ArrowForwardDownPerson())"
                        Color="Color.Lightweight"
                        Title="Iniciar sesión"
                        @onclick="CerrarSesion" />
        }

        <FluentIcon Value="@(modo == DesignThemeModes.Dark ? (Icon)new Icons.Regular.Size24.WeatherSunny() : (Icon)new Icons.Regular.Size24.WeatherMoon())"
                    Color="Color.Lightweight"
                    Title="@(modo == DesignThemeModes.Dark ? "Modo claro" : "Modo oscuro")"
                    @onclick="@(() => modo = modo == DesignThemeModes.Dark ? DesignThemeModes.Light : DesignThemeModes.Dark)" />
    </FluentStack>
</FluentHeader>

@code {
    private DesignThemeModes modo = DesignThemeModes.Light;

    private void Invocar()
    {
        InvokeAsync(StateHasChanged);
    }

    protected override void OnInitialized()
    {
        cuentaService.EnSesionCambiada += Invocar;
    }

    public void Dispose()
    {
        cuentaService.EnSesionCambiada -= Invocar;
    }

    private void CerrarSesion()
    {
        cuentaService.CerrarSesion();
        navigationManager.NavigateTo("/cuenta/sesion-cerrada");
    }
}
